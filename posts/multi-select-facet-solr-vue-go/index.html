<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Multi-Select Facet with Solr, Vue and Go - stevenferrer.github.io</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Implementing multi-select facet with Solr, Vue and Go" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://stevenferrer.github.io/posts/multi-select-facet-solr-vue-go/">
  <meta property="og:site_name" content="stevenferrer.github.io">
  <meta property="og:title" content="Multi-Select Facet with Solr, Vue and Go">
  <meta property="og:description" content="Implementing multi-select facet with Solr, Vue and Go">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-06-30T16:59:01+08:00">
    <meta property="article:modified_time" content="2021-02-10T02:07:28+00:00">
    <meta property="article:tag" content="Solr">
    <meta property="article:tag" content="Go">
    <meta property="article:tag" content="Vue">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Multi-Select Facet with Solr, Vue and Go">
  <meta name="twitter:description" content="Implementing multi-select facet with Solr, Vue and Go">

        <link href="https://stevenferrer.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://stevenferrer.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://stevenferrer.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css"  disabled /><script defer src="https://cloud.umami.is/script.js" 
			data-website-id="dcbea3be-4df1-4b85-b896-1dc5dfdc4f82">
		</script>
		
		
		<link rel="stylesheet" type="text/css" href="https://stevenferrer.github.io/css/custom.6676fbbfabb51623d39a54b5425acea0b92fb8e18272505883356a1f43d3a7af.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://stevenferrer.github.io/">stevenferrer.github.io</a>
	</div>
	<nav>
		
		<a href="/">home</a>
		
		<a href="/posts">all posts</a>
		
		<a href="/tags">tags</a>
		
		<a href="/about">about</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#sun" />
</svg></span>
		<script src="https://stevenferrer.github.io/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Multi-Select Facet with Solr, Vue and Go</h1>
          <div class="meta">Posted on Jun 30, 2020</div>
        </div>
        
        <section class="body">
          <p><img src="/images/multi-select-facet-amz.png" alt="multi-select facet amz"></p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#indexing-and-querying">Indexing and querying</a>
<ul>
<li><a href="#the-data">The data</a></li>
<li><a href="#defining-our-schema">Defining our schema</a></li>
<li><a href="#indexing-the-data">Indexing the data</a></li>
<li><a href="#query-with-facet">Query with facet</a></li>
</ul>
</li>
<li><a href="#api-implementation">API Implementation</a></li>
<li><a href="#front-end-implementation">Front-end implementation</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<h3 id="changelog">Changelog</h3>
<ul>
<li>02/10/2021: Update examples to use the latest version of <a href="https://github.com/sf9v/solr-go">solr-go</a>.</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>A <em>multi-select facet</em> feature give the users the ability to quickly filter the product catalog and help them zero-in on the product that they need. The majority of e-commerces websites support this feature and if you have shopped online before, then you had probably used it before.</p>
<p>I needed to support exactly the same feature for one my project but I didn&rsquo;t know where to start. I didn&rsquo;t even know what this feature was called. I scoured the internet until, luckily, I found this amazing <a href="https://blog.griddynamics.com/multi-select-faceting-for-nested-documents-in-solr/">blog post</a>. It&rsquo;s a very detailed explanation of how to implement a multi-select facet query in <a href="https://lucene.apache.org/solr/">Solr</a>.</p>
<p>In this blog post, we&rsquo;re going to take it further and implement a <a href="https://en.wikipedia.org/wiki/Web_API">web API</a> and a <a href="https://en.wikipedia.org/wiki/Single-page_application">single-page application</a>.</p>
<h2 id="indexing-and-querying">Indexing and querying</h2>
<h3 id="the-data">The data</h3>
<p>We&rsquo;re going to use <em>smartphones</em> and <em>e-readers</em> as our product data since they both have similar attributes. Each record will have a set of <a href="https://en.wikipedia.org/wiki/Stock_keeping_unit"><code>SKUs</code></a>. For example, the first record in our data contains a <em>Apple iPhone 11 Pro Max</em> which has <code>2 variants</code>. The first one has a <em>color</em> of <em>Black</em> with <em>storage capacity</em> of <em>256G</em> and the other one has a <em>color</em> of <em>Space Grey</em> with a <em>storage capacity</em> of <em>64GB</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;id&#34;</span>: <span style="color:#2aa198">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;name&#34;</span>: <span style="color:#2aa198">&#34;Apple iPhone 11 Pro Max&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;brand&#34;</span>: <span style="color:#2aa198">&#34;Apple&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;category&#34;</span>: <span style="color:#2aa198">&#34;Electronic Devices&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;productType&#34;</span>: <span style="color:#2aa198">&#34;Smartphones&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;docType&#34;</span>: <span style="color:#2aa198">&#34;product&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;skus&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;id&#34;</span>: <span style="color:#2aa198">&#34;10&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;docType&#34;</span>: <span style="color:#2aa198">&#34;sku&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;colorFamily_s&#34;</span>: <span style="color:#2aa198">&#34;Black&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;operatingSystem_s&#34;</span>: <span style="color:#2aa198">&#34;iOS&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;storageCapacity_s&#34;</span>: <span style="color:#2aa198">&#34;256GB&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;id&#34;</span>: <span style="color:#2aa198">&#34;11&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;docType&#34;</span>: <span style="color:#2aa198">&#34;sku&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;colorFamily_s&#34;</span>: <span style="color:#2aa198">&#34;Space Grey&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;operatingSystem_s&#34;</span>: <span style="color:#2aa198">&#34;iOS&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;storageCapacity_s&#34;</span>: <span style="color:#2aa198">&#34;64GB&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="defining-our-schema">Defining our schema</h3>
<p>From the above, we have the following list of fields.</p>
<ul>
<li>name - e.g. <em>Apple iPhone 11 Pro Max</em></li>
<li>brand - e.g. <em>Apple</em></li>
<li>category e.g. <em>Electronic Devices</em></li>
<li>productType e.g. <em>Smartphones</em>, <em>E-readers</em></li>
<li>docType - indicates the document type e.g. <em>product</em>, <em>sku</em>. The use of this field will become more apparent in the next sections.</li>
</ul>
<p>You may be asking, <em>Why are we only defining those fields?</em> Great question.</p>
<p>The sku fields <em>colorFamily_s</em>, <em>operatingSystem_s</em>, <em>storageCapacity_s</em> are <a href="https://lucene.apache.org/solr/guide/8_5/dynamic-fields.html">dynamic</a> which means, Solr can infer the type of the field based on its suffix (<strong>_s</strong>). This is really handy when you&rsquo;re dealing with data that might have dynamic attributes like an <code>sku</code>.  Also, the <code>skus</code> do not need to be defined in the schema. More details on <a href="https://lucene.apache.org/solr/guide/8_5/indexing-nested-documents.html#json-examples">nested child documents</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#719e07">...</span>
</span></span><span style="display:flex;"><span>fields <span style="color:#719e07">:=</span> []solr.Field{
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Name:    <span style="color:#2aa198">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>    Type:    <span style="color:#2aa198">&#34;text_general&#34;</span>,
</span></span><span style="display:flex;"><span>    Indexed: <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>    Stored:  <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Name:    <span style="color:#2aa198">&#34;category&#34;</span>,
</span></span><span style="display:flex;"><span>    Type:    <span style="color:#2aa198">&#34;text_gen_sort&#34;</span>,
</span></span><span style="display:flex;"><span>    Indexed: <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>    Stored:  <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Name:    <span style="color:#2aa198">&#34;brand&#34;</span>,
</span></span><span style="display:flex;"><span>    Type:    <span style="color:#2aa198">&#34;text_gen_sort&#34;</span>,
</span></span><span style="display:flex;"><span>    Indexed: <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>    Stored:  <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Name:    <span style="color:#2aa198">&#34;productType&#34;</span>,
</span></span><span style="display:flex;"><span>    Type:    <span style="color:#2aa198">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>    Indexed: <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>    Stored:  <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Name:    <span style="color:#2aa198">&#34;docType&#34;</span>,
</span></span><span style="display:flex;"><span>    Type:    <span style="color:#2aa198">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>    Indexed: <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>    Stored:  <span style="color:#cb4b16">true</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>err <span style="color:#719e07">:=</span> solrClient.<span style="color:#268bd2">AddFields</span>(ctx, collection, fields<span style="color:#719e07">...</span>)
</span></span><span style="display:flex;"><span><span style="color:#719e07">...</span>
</span></span></code></pre></div><h3 id="indexing-the-data">Indexing the data</h3>
<p>Indexing is pretty straightforward, just open the data file and feed it to <em>Solr</em> and commit. That&rsquo;s it!</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#586e75">// open the json containing the data</span>
</span></span><span style="display:flex;"><span>  f, err <span style="color:#719e07">:=</span> os.<span style="color:#268bd2">OpenFile</span>(dataPath, os.O_RDWR, <span style="color:#2aa198">0644</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">// send the json to solr</span>
</span></span><span style="display:flex;"><span>  err = solrClient.<span style="color:#268bd2">Update</span>(ctx, collection, solr.JSON, f)
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">// commit </span>
</span></span><span style="display:flex;"><span>  err = solrClient.<span style="color:#268bd2">Commit</span>(ctx, collection)
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">...</span>
</span></span></code></pre></div><p>Now, we should be able to see that we have sucessfully indexed our data. Notice the <code>fq</code> param is set to <code>docType:product</code>. This will filter all the non-product documents.</p>
<p><img src="/images/products-query-admin-ui.png" alt="smartphones query from admin ui"></p>
<p><em>But, where are the product <code>skus</code>?</em> Another great question.</p>
<p><a href="https://lucene.apache.org/solr/guide/8_5/indexing-nested-documents.html">Nested child documents</a> are indexed like a regular document. Internally, Solr knows which <em>sku</em> documents are related to which <em>products</em>.</p>
<p>To help us identify which document is a <em>product</em> or <em>sku</em>, we are using the <em>docType</em> field. This is the suggested way to handle <em>nested child documents</em> in <em>Solr</em>.</p>
<p><img src="/images/products-query-admin-ui-skus-and-products.png" alt="products query from admin ui - skus and products"></p>
<p>We can include the <em>skus</em> to the <em>product</em> by specifying the value <code>[child]</code> for <code>fl</code> parameter.</p>
<p><img src="/images/products-query-admin-ui-with-skus.png" alt="smartphones query from admin ui with skus"></p>
<h3 id="query-with-facet">Query with facet</h3>
<p>The query in this example is heavily inspired the <a href="https://blog.griddynamics.com/multi-select-faceting-for-nested-documents-in-solr/">blog post</a> mentioned earlier. I suggest reading it thoroughly before proceeding to the next section.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;query&#34;</span>: <span style="color:#2aa198">&#34;{!parent tag=top filters=$skuFilters which=docType:product v=docType:sku}&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;queries&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;skuFilters&#34;</span>: [<span style="color:#2aa198">&#34;{!tag=colorFamily_s}colorFamily_s:Black&#34;</span>]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;filter&#34;</span>: [<span style="color:#2aa198">&#34;{!tag=top}brand:Amazon&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;facet&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Brand&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;facet&#34;</span>: { <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">&#34;uniqueBlock(_root_)&#34;</span> },
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;field&#34;</span>: <span style="color:#2aa198">&#34;brand&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;limit&#34;</span>: <span style="color:#2aa198">-1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;type&#34;</span>: <span style="color:#2aa198">&#34;terms&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Color Family&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;domain&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;excludeTags&#34;</span>: <span style="color:#2aa198">&#34;top&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;filter&#34;</span>: [
</span></span><span style="display:flex;"><span>          <span style="color:#2aa198">&#34;{!filters param=$skuFilters excludeTags=colorFamily_s v=$sku}&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#2aa198">&#34;{!child of=docType:product filters=$filter v=docType:product}&#34;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;facet&#34;</span>: { <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">&#34;uniqueBlock(_root_)&#34;</span> },
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;field&#34;</span>: <span style="color:#2aa198">&#34;colorFamily_s&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;limit&#34;</span>: <span style="color:#2aa198">-1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;type&#34;</span>: <span style="color:#2aa198">&#34;terms&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let&rsquo;s break it down a little bit so that we can have a better understanding each part of the query.</p>
<p>Here, we&rsquo;re using <a href="https://lucene.apache.org/solr/guide/8_5/other-parsers.html#block-join-parent-query-parser">block join parent query parser</a>. This parser takes a query value (<code>v=docType:sku</code>) and filter (<code>filters:$skuFilters</code>) that matches the child documents (<code>skus</code>) and returns their parents (<code>which=docType:product</code>).</p>
<p>Note the <code>$</code> (dollar symbol) in the <code>filters:$skuFilters</code>. We use this syntax to reference other values in query body.</p>
<p>Also, we&rsquo;re specifying <code>tag:top</code> which will be useful when we want to exclude the <em>product filters</em> in the child facet settings. More details on <a href="https://lucene.apache.org/solr/guide/8_5/faceting.html#tagging-and-excluding-filters"><code>tagging and excluding filters</code></a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;query&#34;</span>: <span style="color:#2aa198">&#34;{!parent tag=top filters=$skuFilters which=docType:product v=docType:sku}&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;queries&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;skuFilters&#34;</span>: [<span style="color:#2aa198">&#34;{!tag=colorFamily_s}colorFamily_s:Black&#34;</span>]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;filter&#34;</span>: [<span style="color:#2aa198">&#34;{!tag=top}brand:Amazon&#34;</span>],
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Next,  we&rsquo;re specifying a <a href="https://lucene.apache.org/solr/guide/8_5/json-facet-api.html#terms-facet">terms facet</a>. This will produce a list of values based on the field <code>colorFamily_s</code> which will only be applied to <em>sku</em> documents. We&rsquo;re excluding the <em>top</em> filter so it doesn&rsquo;t get applied to this facet setting. We&rsquo;ve also included the <code>&quot;productCount&quot;: &quot;uniqueBlock(_root_)&quot;</code> to count the <em>unique products</em> that matches the child <em>skus</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;facet&#34;</span>: {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Color Family&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;field&#34;</span>: <span style="color:#2aa198">&#34;colorFamily_s&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;type&#34;</span>: <span style="color:#2aa198">&#34;terms&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;limit&#34;</span>: <span style="color:#2aa198">-1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;facet&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">&#34;uniqueBlock(_root_)&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;domain&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;excludeTags&#34;</span>: <span style="color:#2aa198">&#34;top&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;filter&#34;</span>: [
</span></span><span style="display:flex;"><span>          <span style="color:#2aa198">&#34;{!filters param=$skuFilters excludeTags=colorFamily_s v=docType:sku}&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#2aa198">&#34;{!child of=docType:product filters=$filter v=docType:product}&#34;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The next facet setting is very similar to above, but is a lot simplier, as it is only applied to top level documents (<em>products</em>).</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;facet&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Brand&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;field&#34;</span>: <span style="color:#2aa198">&#34;brand&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;limit&#34;</span>: <span style="color:#2aa198">-1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;type&#34;</span>: <span style="color:#2aa198">&#34;terms&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;facet&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">&#34;uniqueBlock(_root_)&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let&rsquo;s test our query and see the results.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Brand&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;buckets&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Amazon&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;count&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Color Family&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;buckets&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Black&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;count&#34;</span>: <span style="color:#2aa198">6</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Space Grey&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;count&#34;</span>: <span style="color:#2aa198">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">2</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Blue&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;count&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>For each bucket, we can see that we have the <code>val</code> which is unique value for the field, <code>count</code> which indicates the number of <code>skus</code> that matched, and the <code>productCount</code> which indicates the number of <em>unique</em> products that matched (i.e. Assume that <code>2 skus</code> matched the query but they both belong to the same parent product, thus <code>productCount</code> is <code>1</code>).</p>
<h2 id="api-implementation">API implementation</h2>
<p>Our API will have a <code>/search</code> endpoint which will simplify the querying and processing of results for us. Optionally, we can have a <code>/suggest</code> endpoint for autosuggest feature.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ curl http://localhost:8081/search?q<span style="color:#719e07">=</span>Apple&amp;<span style="color:#268bd2">colorFamilies</span><span style="color:#719e07">=</span>Black%2CGold&amp;<span style="color:#268bd2">operatingSystems</span><span style="color:#719e07">=</span>iOS
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;facets&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;buckets&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;skuCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Apple&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;name&#34;</span>: <span style="color:#2aa198">&#34;Brand&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;param&#34;</span>: <span style="color:#2aa198">&#34;brands&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;buckets&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;skuCount&#34;</span>: <span style="color:#2aa198">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Space Grey&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;skuCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Black&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;skuCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Gold&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;productCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;skuCount&#34;</span>: <span style="color:#2aa198">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#268bd2">&#34;val&#34;</span>: <span style="color:#2aa198">&#34;Midnight Green&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;name&#34;</span>: <span style="color:#2aa198">&#34;Color Family&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;param&#34;</span>: <span style="color:#2aa198">&#34;colorFamilies&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;products&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;brand&#34;</span>: <span style="color:#2aa198">&#34;Apple&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;category&#34;</span>: <span style="color:#2aa198">&#34;Electronic Devices&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;id&#34;</span>: <span style="color:#2aa198">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;name&#34;</span>: <span style="color:#2aa198">&#34;Apple iPhone 11 Pro Max&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;productType&#34;</span>: <span style="color:#2aa198">&#34;Smartphones&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="front-end-implementation">Front-end implementation</h2>
<p>Our web app will display the filters and the list of products that matched. We should be able to change the filters by checking/unchecking the filters on the left side of the screen.</p>
<p><img src="/images/webapp.png" alt="webapp"></p>
<h2 id="conclusion">Conclusion</h2>
<p>For beginners like me, implementing a multi-select facet in Solr is very intidimidating task when you don&rsquo;t know where to start. Thankfully, Solr has a very good documentation and there are blogs written that explains how to implement them which guided me in my implementation.</p>
<p>The complete implementation can be found in <a href="https://github.com/sf9v/multi-select-facet">this repository</a>. If you have any suggestions, you can open an issue in the repository.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://lucene.apache.org/solr/guide/8_5/">Apache Solr Reference Guide</a></li>
<li><a href="https://blog.griddynamics.com/multi-select-faceting-for-nested-documents-in-solr/">How to implement multi-select faceting for nested documents in Solr</a></li>
<li><a href="http://yonik.com/multi-select-faceting/">Multi-Select Faceting</a></li>
<li><a href="https://blog.griddynamics.com/implementing-autocomplete-with-solr/">Implementing autocomplete with Solr</a></li>
<li><a href="https://blog.griddynamics.com/implement-autocomplete-search-for-large-e-commerce-catalogs/">How to implement autocomplete search for large-scale e-commerce catalogs</a></li>
</ul>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/solr">solr</a></li>
              
              <li><a href="/tags/go">go</a></li>
              
              <li><a href="/tags/vue">vue</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/stevenferrer" rel="me" title="Github"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
</svg></a><a class="border"></a><a class="soc" href="https://www.linkedin.com/in/stevenferrer" rel="me" title="Linkedin"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#linkedin" />
</svg></a><a class="border"></a></div>
  <div class="footer-info">
    2025  © Steven Ferrer |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
